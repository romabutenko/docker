ARG STAGE=${STAGE}
ARG PROJECT_NAME=${PROJECT_NAME}
FROM ${PROJECT_NAME}/${STAGE}/builder:latest

USER root

ARG WEB_REPO
ARG WEB_CODE_PATH_CONTAINER=/var/apps/palantir/web

RUN mkdir -p ${WEB_CODE_PATH_CONTAINER}

RUN git clone ${WEB_REPO} ${WEB_CODE_PATH_CONTAINER}

WORKDIR ${WEB_CODE_PATH_CONTAINER}

RUN npm install && \
    npm run build

WORKDIR ${WEB_CODE_PATH_CONTAINER}